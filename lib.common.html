<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Module lib.common &#8212; lcdb-wf 1.9 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=c8a1a12d" />
    <script src="_static/documentation_options.js?v=754f84b7"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Module lib.chipseq" href="lib.chipseq.html" />
    <link rel="prev" title="For Developers" href="developers.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="toc.html">lcdb-wf</a></h1>



<p class="blurb">Customizable workflows for high-throughput sequencing analysis</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide.html">Guide to file hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Overview of workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="rnaseq.html">RNA-seq workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="downstream-rnaseq.html">RNA-Seq downstream analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipseq.html">ChIP-seq workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrative.html">Integrative workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">conda and conda envs in <cite>lcdb-wf</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Testing the installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="faqs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developers.html">For Developers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="developers.html#creating-and-updating-conda-envs">Creating and updating conda envs</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#running-the-full-complex-datasets">Running the full complex datasets</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="developers.html#module-documentation">Module documentation</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Module <code class="docutils literal notranslate"><span class="pre">lib.common</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="lib.chipseq.html">Module <code class="docutils literal notranslate"><span class="pre">lib.chipseq</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="lib.patterns_targets.html">Module <code class="docutils literal notranslate"><span class="pre">lib.patterns_targets</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#adding-a-new-aligner">Adding a new aligner</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#adding-a-new-peak-caller">Adding a new peak-caller</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="toc.html">Documentation overview</a><ul>
  <li><a href="developers.html">For Developers</a><ul>
      <li>Previous: <a href="developers.html" title="previous chapter">For Developers</a></li>
      <li>Next: <a href="lib.chipseq.html" title="next chapter">Module <code class="docutils literal notranslate"><span class="pre">lib.chipseq</span></code></a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-lib-common">
<h1>Module <code class="docutils literal notranslate"><span class="pre">lib.common</span></code><a class="headerlink" href="#module-lib-common" title="Link to this heading">¶</a></h1>
<p>This module contains various helper functions used by the workflows. It has two
main types of functions, those for handling configuration information those for
handling references.</p>
<section id="functions-for-handling-configuration">
<h2>Functions for handling configuration<a class="headerlink" href="#functions-for-handling-configuration" title="Link to this heading">¶</a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#lib.common.resolve_config" title="lib.common.resolve_config"><code class="xref py py-obj docutils literal notranslate"><span class="pre">resolve_config</span></code></a>(config[, workdir])</p></td>
<td><p>Finds the config file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lib.common.references_dict" title="lib.common.references_dict"><code class="xref py py-obj docutils literal notranslate"><span class="pre">references_dict</span></code></a>(config)</p></td>
<td><p>Transforms the references section of the config file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#lib.common.get_references_dir" title="lib.common.get_references_dir"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_references_dir</span></code></a>(config)</p></td>
<td><p>Identify the references directory based on config and env vars.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lib.common.get_sampletable" title="lib.common.get_sampletable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_sampletable</span></code></a>(config)</p></td>
<td><p>Return samples and pandas.DataFrame of parsed sampletable.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="functions-for-handling-references">
<h2>Functions for handling references<a class="headerlink" href="#functions-for-handling-references" title="Link to this heading">¶</a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#lib.common.gzipped" title="lib.common.gzipped"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gzipped</span></code></a>(tmpfiles, outfile)</p></td>
<td><p>Cat-and-gzip a list of uncompressed files into a compressed output file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lib.common.cat" title="lib.common.cat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cat</span></code></a>(tmpfiles, outfile)</p></td>
<td><p>Simple concatenation of files.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#lib.common.filter_fastas" title="lib.common.filter_fastas"><code class="xref py py-obj docutils literal notranslate"><span class="pre">filter_fastas</span></code></a>(tmpfiles, outfile, pattern)</p></td>
<td><p>Extract records from fasta file(s) given a search pattern.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lib.common.twobit_to_fasta" title="lib.common.twobit_to_fasta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">twobit_to_fasta</span></code></a>(tmpfiles, outfile)</p></td>
<td><p>Converts .2bit files to fasta.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#lib.common.download_and_postprocess" title="lib.common.download_and_postprocess"><code class="xref py py-obj docutils literal notranslate"><span class="pre">download_and_postprocess</span></code></a>(outfile, config, ...)</p></td>
<td><p>Given an output file, figure out what to do based on the config.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-lib.common">
<span id="details"></span><h2>Details<a class="headerlink" href="#module-lib.common" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lib.common.cat">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">cat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmpfiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#cat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.cat" title="Link to this definition">¶</a></dt>
<dd><p>Simple concatenation of files.</p>
<p>Note that gzipped files can be concatenated as-is without un- and re-
compressing.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.check_all_urls_found">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">check_all_urls_found</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#check_all_urls_found"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.check_all_urls_found" title="Link to this definition">¶</a></dt>
<dd><p>Recursively loads all references that can be included and checks them.
Reports out if there are any failures.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.check_url">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">check_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#check_url"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.check_url" title="Link to this definition">¶</a></dt>
<dd><p>Try to open – and then immediately close – a URL.</p>
<p>Any exceptions can be handled upstream.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.check_urls">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">check_urls</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#check_urls"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.check_urls" title="Link to this definition">¶</a></dt>
<dd><p>Given a config filename or existing object, extract the URLs and check
them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – Config object to inspect</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – Print which URL is being checked</p></li>
<li><p><strong>wait</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – Number of seconds to wait in between checking URLs, to avoid
too-many-connection issues</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.deprecation_handler">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">deprecation_handler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#deprecation_handler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.deprecation_handler" title="Link to this definition">¶</a></dt>
<dd><p>Checks the config to see if anything has been deprecated.</p>
<p>Also makes any fixes that can be done automatically.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.download_and_postprocess">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">download_and_postprocess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">organism</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#download_and_postprocess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.download_and_postprocess" title="Link to this definition">¶</a></dt>
<dd><p>Given an output file, figure out what to do based on the config.</p>
<p>See notes below for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outfile</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – </p></li>
<li><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – </p></li>
<li><p><strong>organism</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Which organism to use. Must be a key in the “references” section of the
config.</p></li>
<li><p><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Which tag for the organism to use. Must be a tag for the organism in
the config</p></li>
<li><p><strong>type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – A supported references type (gtf, fasta) to use.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function:</p>
<blockquote>
<div><ul>
<li><p>uses <cite>organism</cite>, <cite>tag</cite>, <cite>type_</cite> as a key into the config dict to
figure out:</p>
<blockquote>
<div><ul class="simple">
<li><p>what postprocessing function (if any) was specified along with
its optional args</p></li>
<li><p>the URL[s] to download</p></li>
</ul>
</div></blockquote>
</li>
<li><p>resolves the name of the postprocessing function (if provided) and
imports it</p></li>
<li><p>downloads the URL[s] to tempfile[s]</p></li>
<li><p>calls the imported postprocessing function using the tempfile[s] and
outfile plus any additional specified arguments.</p></li>
</ul>
</div></blockquote>
<p>The postprocessing function must have one of the following signatures,
where <cite>infiles</cite> contains the list of temporary files downloaded from the
URL or URLs specified, and <cite>outfile</cite> is a gzipped file expected to be
created by the function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The function is specified as a string that resolves to an importable
function, e.g., <cite>postprocess: lib.postprocess.dm6.fix</cite> will call a function
called <cite>fix</cite> in the file <cite>lib/postprocess/dm6.py</cite>.</p>
<p>If the contents of <cite>postprocess:</cite> is a dict, it must have at least the key
<cite>function</cite>, and optionally <cite>args</cite> and/or <cite>kwargs</cite> keys. The <cite>function</cite> key
indicates the importable path to the function.  <cite>args</cite> can be a string
or list of arguments that will be provided as additional args to a function
with the second kind of signature above.  If <cite>kwargs</cite> is provided, it is
a dict that is passed to the function with the third kind of signature
above. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postprocess</span><span class="p">:</span>
    <span class="n">function</span><span class="p">:</span> <span class="n">lib</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">dm6</span><span class="o">.</span><span class="n">fix</span>
    <span class="n">args</span><span class="p">:</span>
        <span class="o">-</span> <span class="kc">True</span>
        <span class="o">-</span> <span class="mi">3</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postprocess</span><span class="p">:</span>
    <span class="n">function</span><span class="p">:</span> <span class="n">lib</span><span class="o">.</span><span class="n">postprocess</span><span class="o">.</span><span class="n">dm6</span><span class="o">.</span><span class="n">fix</span>
    <span class="n">args</span><span class="p">:</span>
        <span class="o">-</span> <span class="kc">True</span>
        <span class="o">-</span> <span class="mi">3</span>
    <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">skip</span><span class="p">:</span> <span class="n">exon</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.fill_r1_r2">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">fill_r1_r2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampletable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r1_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#fill_r1_r2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.fill_r1_r2" title="Link to this definition">¶</a></dt>
<dd><p>Returns a function intended to be used as a rule’s input function.</p>
<p>The returned function, when provided with wildcards, will return one or two
rendered versions of a pattern depending on SE or PE respectively.
Specifically, given a pattern (which is expected to contain a placeholder
for “{sample}” and “{n}”), look up in the sampletable whether or not it is
paired-end.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sampletable</strong> (<em>pandas.DataFrame</em>) – Contains a “layout” column with either “SE” or “PE”, or “LibraryLayout”
column with “SINGLE” or “PAIRED”. If column does not exist, assume SE.</p></li>
<li><p><strong>pattern</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Must contain at least a “{sample}” placeholder.</p></li>
<li><p><strong>r1_only</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – If True, then only return the file for R1 even if PE is configured.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.filter_fastas">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">filter_fastas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmpfiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#filter_fastas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.filter_fastas" title="Link to this definition">¶</a></dt>
<dd><p>Extract records from fasta file(s) given a search pattern.</p>
<p>Given input gzipped FASTAs, create a new gzipped fasta containing only
records whose description matches <cite>pattern</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tmpfiles</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a>) – gzipped fasta files to look through</p></li>
<li><p><strong>outfile</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – gzipped output fastq file</p></li>
<li><p><strong>pattern</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Look for this string in each record’s description</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.get_references_dir">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">get_references_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#get_references_dir"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.get_references_dir" title="Link to this definition">¶</a></dt>
<dd><p>Identify the references directory based on config and env vars.</p>
<p>Returns the references dir, preferring the value of an existing environment
variable <cite>REFERENCES_DIR</cite> over the config entry “references_dir”. Raise an
error if either can’t be found.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.get_sampletable">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">get_sampletable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#get_sampletable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.get_sampletable" title="Link to this definition">¶</a></dt>
<dd><p>Return samples and pandas.DataFrame of parsed sampletable.</p>
<p>Returns the sample IDs and the parsed sampletable from the file specified
in the config.</p>
<p>The sample IDs are assumed to be the first column of the sampletable.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.get_techreps">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">get_techreps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampletable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#get_techreps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.get_techreps" title="Link to this definition">¶</a></dt>
<dd><p>Return all sample IDs for which the “label” column is <cite>label</cite>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.gff2gtf">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">gff2gtf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gtf</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#gff2gtf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.gff2gtf" title="Link to this definition">¶</a></dt>
<dd><p>Converts a gff file to a gtf format using the gffread function from Cufflinks</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.gzipped">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">gzipped</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmpfiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#gzipped"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.gzipped" title="Link to this definition">¶</a></dt>
<dd><p>Cat-and-gzip a list of uncompressed files into a compressed output file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.is_paired_end">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">is_paired_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampletable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#is_paired_end"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.is_paired_end" title="Link to this definition">¶</a></dt>
<dd><p>Inspects the sampletable to see if the sample is paired-end or not</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sampletable</strong> (<em>pandas.DataFrame</em>) – Contains a “layout” or “LibraryLayout” column (but not both). If the
lowercase value is “pe” or “paired”, consider the sample paired-end.
Otherwise consider single-end.</p></li>
<li><p><strong>sample</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Assumed to be found in the first column of <cite>sampletable</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.load_config">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">load_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">missing_references_ok</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#load_config"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.load_config" title="Link to this definition">¶</a></dt>
<dd><p>Loads the config.</p>
<p>Resolves any included references directories/files and runs the deprecation
handler.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.openfile">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">openfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#openfile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.openfile" title="Link to this definition">¶</a></dt>
<dd><p>Returns an open file handle; auto-detects gzipped files.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.pluck">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">pluck</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kv</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#pluck"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.pluck" title="Link to this definition">¶</a></dt>
<dd><p>For a given dict or list that somewhere contains keys <cite>kv</cite>, return the
values of those keys.</p>
<p>Named after the dplyr::pluck, and implemented based on
https://stackoverflow.com/a/1987195</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.references_dict">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">references_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#references_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.references_dict" title="Link to this definition">¶</a></dt>
<dd><p>Transforms the references section of the config file.</p>
<p>The references section of the config file is designed to be human-editable,
and to only need the URL(s). User-specified indexes, conversions, and
post-processing functions can also be added.</p>
<p>For example, the config might say:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">human</span><span class="p">:</span>
  <span class="n">gencode</span><span class="p">:</span>
    <span class="n">fasta</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">url</span> <span class="n">to</span> <span class="n">fasta</span><span class="o">&gt;</span>
        <span class="n">indexes</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">hisat2</span>
</pre></div>
</div>
<p>In this function, we need to convert that “indexes: [hisat2]” into the full
path of the hisat2 index that can be used as input for a Snakemake rule. In
this example, in the dictionary returned below we can then get that path
with <cite>d[‘human’][‘gencode’][‘hisat2’]</cite>, or more generally,
<cite>d[organism][tag][type]</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – </p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The config file is designed to be easy to edit and use from the user’s
standpoint. But it’s not so great for practical usage. Here we convert the
config file which has the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="n">references_dir</span><span class="p">:</span> <span class="s2">&quot;/data&quot;</span>
<span class="o">...</span> <span class="n">references</span><span class="p">:</span>
<span class="o">...</span>   <span class="n">dm6</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">r6</span><span class="o">-</span><span class="mi">11</span><span class="p">:</span>
<span class="o">...</span>       <span class="n">metadata</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">reference_genome_build</span><span class="p">:</span> <span class="s1">&#39;dm6&#39;</span>
<span class="o">...</span>         <span class="n">reference_effective_genome_count</span><span class="p">:</span> <span class="mf">1.2e7</span>
<span class="o">...</span>         <span class="n">reference_effective_genome_proportion</span><span class="p">:</span> <span class="mf">0.97</span>
<span class="o">...</span>       <span class="n">genome</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">url</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="o">...</span>         <span class="n">indexes</span><span class="p">:</span>
<span class="o">...</span>           <span class="o">-</span> <span class="n">bowtie2</span>
<span class="o">...</span>           <span class="o">-</span> <span class="n">hisat2</span>
<span class="o">...</span>       <span class="n">annotation</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">url</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="o">...</span>         <span class="n">conversions</span><span class="p">:</span>
<span class="o">...</span>           <span class="o">-</span> <span class="n">refflat</span>
<span class="o">...</span>       <span class="n">transcriptome</span><span class="p">:</span>
<span class="o">...</span>           <span class="n">indexes</span><span class="p">:</span>
<span class="o">...</span>             <span class="o">-</span> <span class="n">salmon</span>
</pre></div>
</div>
<p>To this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="s1">&#39;dm6&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="o">...</span>    <span class="s1">&#39;r6-11&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="o">...</span>        <span class="s1">&#39;annotation&#39;</span><span class="p">:</span>    <span class="s1">&#39;/data/dm6/r6-11/annotation/dm6_r6-11.gtf&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;bowtie2&#39;</span><span class="p">:</span>       <span class="s1">&#39;/data/dm6/r6-11/genome/bowtie2/dm6_r6-11.1.bt2&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;bowtie2_fasta&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/dm6/r6-11/genome/bowtie2/dm6_r6-11.fasta&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;chromsizes&#39;</span><span class="p">:</span>    <span class="s1">&#39;/data/dm6/r6-11/genome/dm6_r6-11.chromsizes&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;genome&#39;</span><span class="p">:</span>        <span class="s1">&#39;/data/dm6/r6-11/genome/dm6_r6-11.fasta&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;hisat2&#39;</span><span class="p">:</span>        <span class="s1">&#39;/data/dm6/r6-11/genome/hisat2/dm6_r6-11.1.ht2&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;hisat2_fasta&#39;</span><span class="p">:</span>  <span class="s1">&#39;/data/dm6/r6-11/genome/hisat2/dm6_r6-11.fasta&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;refflat&#39;</span><span class="p">:</span>       <span class="s1">&#39;/data/dm6/r6-11/annotation/dm6_r6-11.refflat&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;salmon&#39;</span><span class="p">:</span>        <span class="s1">&#39;/data/dm6/r6-11/transcriptome/salmon/dm6_r6-11/versionInfo.json&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;salmon_fasta&#39;</span><span class="p">:</span>  <span class="s1">&#39;/data/dm6/r6-11/transcriptome/salmon/dm6_r6-11.fasta&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="s1">&#39;transcriptome&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/dm6/r6-11/transcriptome/dm6_r6-11.fasta&#39;</span><span class="p">,</span>
<span class="o">...</span>        <span class="p">},</span>
<span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.resolve_config">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">resolve_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#resolve_config"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.resolve_config" title="Link to this definition">¶</a></dt>
<dd><p>Finds the config file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – If str, assume it’s a YAML file and parse it; otherwise pass through</p></li>
<li><p><strong>workdir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – Optional location to specify relative location of all paths in <cite>config</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.common.twobit_to_fasta">
<span class="sig-prename descclassname"><span class="pre">lib.common.</span></span><span class="sig-name descname"><span class="pre">twobit_to_fasta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmpfiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lib/common.html#twobit_to_fasta"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lib.common.twobit_to_fasta" title="Link to this definition">¶</a></dt>
<dd><p>Converts .2bit files to fasta.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tmpfiles</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a>) – 2bit files to convert</p></li>
<li><p><strong>outfile</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – gzipped output fastq file</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, Ryan Dale, Justin Fear.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/lib.common.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>