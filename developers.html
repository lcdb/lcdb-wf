<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>For Developers &#8212; lcdb-wf 1.9 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=9735eac1" />
    <script src="_static/documentation_options.js?v=754f84b7"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Module lib.common" href="lib.common.html" />
    <link rel="prev" title="Changelog" href="changelog.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="toc.html">lcdb-wf</a></h1>



<p class="blurb">Customizable workflows for high-throughput sequencing analysis</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide.html">Guide to file hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Overview of workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="rnaseq.html">RNA-seq workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="downstream-rnaseq.html">RNA-Seq downstream analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipseq.html">ChIP-seq workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrative.html">Integrative workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">conda and conda envs in <cite>lcdb-wf</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Testing the installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="faqs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">For Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-and-updating-conda-envs">Creating and updating conda envs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-full-complex-datasets">Running the full complex datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-documentation">Module documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="lib.common.html">Module <code class="docutils literal notranslate"><span class="pre">lib.common</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="lib.chipseq.html">Module <code class="docutils literal notranslate"><span class="pre">lib.chipseq</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="lib.patterns_targets.html">Module <code class="docutils literal notranslate"><span class="pre">lib.patterns_targets</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-aligner">Adding a new aligner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modules">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-peak-caller">Adding a new peak-caller</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="toc.html">Documentation overview</a><ul>
      <li>Previous: <a href="changelog.html" title="previous chapter">Changelog</a></li>
      <li>Next: <a href="lib.common.html" title="next chapter">Module <code class="docutils literal notranslate"><span class="pre">lib.common</span></code></a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="for-developers">
<h1>For Developers<a class="headerlink" href="#for-developers" title="Link to this heading">¶</a></h1>
<section id="creating-and-updating-conda-envs">
<h2>Creating and updating conda envs<a class="headerlink" href="#creating-and-updating-conda-envs" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">env.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">env-r.yml</span></code> files contain fully-pinned versions of the
environments. This hopefully helps with stability and can dramatically speed up
the creation of environment. However these env definitions periodically need to
be updated.</p>
<p>To do so, create new environments using the unpinned versions in
<code class="docutils literal notranslate"><span class="pre">include/requirements.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">include/requirements-r.txt</span></code>. This may take
substantially longer to create.</p>
<p>Then run the tests (<a class="reference internal" href="tests.html#running-the-tests"><span class="std std-ref">Testing the installation</span></a>) using those environments.</p>
<p>If all tests pass, then export the newly-created environments to the
<code class="docutils literal notranslate"><span class="pre">env.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">env-r.yml</span></code> files.</p>
<p>When you commit and push those files, the CI/CD system will detect that they
are different and will trigger a re-build of the cached environments and
proceed with the tests using those new environments.</p>
</section>
<section id="running-the-full-complex-datasets">
<h2>Running the full complex datasets<a class="headerlink" href="#running-the-full-complex-datasets" title="Link to this heading">¶</a></h2>
<p>Prior to a release, the complex datasets should be run. These do a more
extensive job in testing the corner cases. This should be run on a cluster or
a machine with substantial resources. The configs can be found in
<code class="docutils literal notranslate"><span class="pre">include/test</span></code>. Here is how to run it using the WRAPPER_SLURM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>../../include/WRAPPER_SLURM<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--configfile<span class="w"> </span>../../test/test_configs/complex-dataset-rnaseq-config.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--config<span class="w"> </span><span class="nv">sampletable</span><span class="o">=</span>../../test/test_configs/complex-dataset-rnaseq-sampletable.tsv
</pre></div>
</div>
</section>
<section id="module-documentation">
<h2>Module documentation<a class="headerlink" href="#module-documentation" title="Link to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="lib.common.html">Module <code class="docutils literal notranslate"><span class="pre">lib.common</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="lib.common.html#functions-for-handling-configuration">Functions for handling configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib.common.html#functions-for-handling-references">Functions for handling references</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib.common.html#module-lib.common">Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lib.chipseq.html">Module <code class="docutils literal notranslate"><span class="pre">lib.chipseq</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="lib.chipseq.html#module-lib.chipseq">Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lib.patterns_targets.html">Module <code class="docutils literal notranslate"><span class="pre">lib.patterns_targets</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="lib.patterns_targets.html#details">Details</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="adding-a-new-aligner">
<h2>Adding a new aligner<a class="headerlink" href="#adding-a-new-aligner" title="Link to this heading">¶</a></h2>
<section id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Link to this heading">¶</a></h3>
<p>In <cite>lib/common.py</cite>, there is a function <cite>references_dict</cite>. Within that is
a <cite>index_extensions</cite> dictionary. You’ll need to add the name of the aligner and
the extension of the index it creates. If it creates multiple index files, just
one should be sufficient. The filename will be automatically created and will
be used as the expected output file which can then be accessed from the
references dict as <cite>references_dict[organism][tag][aligner]</cite> for use in various
rules that need the index as input (that is, any mapping rules).</p>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>add the aligner to the <cite>include/reference_configs/test.yaml</cite> config file,
“indexes:” section.</p></li>
<li><p>write a rule in <cite>workflows/references/Snakefile</cite> to build the index. Use the
other index-building rules there as a guide.</p></li>
<li><p>Depending on which type of workflow the aligner is appropriate for, add
a rule there. Enclose it in an “if:” clause to only run if the config file
has specified that aligner.</p></li>
<li><p>add the name to the list of supported aligners in <cite>docs/config-yaml.rst</cite>, in
the “Aligner config” section.</p></li>
<li><p>add appropriate memory/time requirements to the rule for that aligner.</p></li>
</ul>
</section>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>For testing, create a copy of the config for any workflows it is used for,
and change only the aligner.</p></li>
<li><p>Modify <cite>.circleci/config.yml</cite> to include a new block in each of the
variables, jobs, and workflows sections. Use the <cite>rnaseq-star</cite> blocks as
a guide for this. The idea is to only run up through the aligner step in
a parallel task (to save on CI build time).</p></li>
</ul>
</section>
</section>
<section id="adding-a-new-peak-caller">
<span id="new-peak-caller"></span><h2>Adding a new peak-caller<a class="headerlink" href="#adding-a-new-peak-caller" title="Link to this heading">¶</a></h2>
<p>First, write a wrapper for the peak-caller. You can use the <code class="docutils literal notranslate"><span class="pre">macs2</span></code>, <code class="docutils literal notranslate"><span class="pre">spp</span></code>,
and <code class="docutils literal notranslate"><span class="pre">sicer</span></code> wrappers as a guide. A wrapper should expect one or more sorted
and indexed BAM files as IP, one or more sorted and indexed BAM files as input.
The wrapper should create at least a sorted BED file of peaks, and can
optionally create other supplemental files as well.</p>
<p>Next, add the peak-caller to the top of <code class="docutils literal notranslate"><span class="pre">lib/patterns_targets.py</span></code> in the
<code class="docutils literal notranslate"><span class="pre">PEAK_CALLERS</span></code> list.</p>
<p>Then write a rule for the peak-caller, again using <code class="docutils literal notranslate"><span class="pre">macs2</span></code>, <code class="docutils literal notranslate"><span class="pre">spp</span></code>, or
<code class="docutils literal notranslate"><span class="pre">sicer</span></code> rules as a guide.</p>
<p>Last, add additional lines in
<code class="docutils literal notranslate"><span class="pre">workflows/chipseq/config/chipseq-patterns.yaml</span></code> for the
<code class="docutils literal notranslate"><span class="pre">patterns_by_peaks</span></code> key.</p>
<p>To test or use, add the new peak-caller to the
<code class="docutils literal notranslate"><span class="pre">workflows/chipseq/config/config.yaml</span></code> file’s <code class="docutils literal notranslate"><span class="pre">peak_calling</span></code> key.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2017, Ryan Dale, Justin Fear.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/developers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>